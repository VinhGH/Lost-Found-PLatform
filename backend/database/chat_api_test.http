###
# ðŸ’¬ Chat API Tests
# Sá»­ dá»¥ng vá»›i REST Client extension trong VS Code
# Hoáº·c import vÃ o Postman/Thunder Client
###

### Variables
@baseUrl = http://localhost:5000/api
@token = YOUR_TOKEN_HERE
@conversationId = 1

###
# 1. âœ… Create Conversation from Match
POST {{baseUrl}}/chat/conversations
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "match_id": 1
}

###
# 2. âœ… Get All Conversations (for current user)
GET {{baseUrl}}/chat/conversations
Authorization: Bearer {{token}}

###
# 3. âœ… Get Conversation by ID
GET {{baseUrl}}/chat/conversations/{{conversationId}}
Authorization: Bearer {{token}}

###
# 4. âœ… Get Messages in Conversation
GET {{baseUrl}}/chat/conversations/{{conversationId}}/messages
Authorization: Bearer {{token}}

###
# 5. âœ… Get Messages with Pagination
GET {{baseUrl}}/chat/conversations/{{conversationId}}/messages?limit=10&offset=0
Authorization: Bearer {{token}}

###
# 6. âœ… Send Message
POST {{baseUrl}}/chat/conversations/{{conversationId}}/messages
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "message": "Xin chÃ o! ÄÃ¢y cÃ³ pháº£i lÃ  Ä‘á»“ cá»§a báº¡n khÃ´ng?"
}

###
# 7. âœ… Send Another Message
POST {{baseUrl}}/chat/conversations/{{conversationId}}/messages
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "message": "VÃ¢ng, Ä‘Ãºng rá»“i! Cáº£m Æ¡n báº¡n ráº¥t nhiá»u!"
}

###
# 8. âœ… Send Long Message
POST {{baseUrl}}/chat/conversations/{{conversationId}}/messages
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "message": "TÃ´i cÃ³ thá»ƒ Ä‘áº¿n láº¥y Ä‘á»“ vÃ o lÃºc 2 giá» chiá»u nay Ä‘Æ°á»£c khÃ´ng? TÃ´i sáº½ Ä‘áº¿n thÆ° viá»‡n DTU. Náº¿u báº¡n báº­n thÃ¬ cÃ³ thá»ƒ háº¹n láº¡i vÃ o ngÃ y mai cÅ©ng Ä‘Æ°á»£c nhÃ©!"
}

###
# âŒ Error Cases

###
# Error 1: Create conversation without match_id
POST {{baseUrl}}/chat/conversations
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "invalid_field": "test"
}

###
# Error 2: Send empty message
POST {{baseUrl}}/chat/conversations/{{conversationId}}/messages
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "message": ""
}

###
# Error 3: Send message without auth
POST {{baseUrl}}/chat/conversations/{{conversationId}}/messages
Content-Type: application/json

{
  "message": "Test unauthorized"
}

###
# Error 4: Access conversation without permission
GET {{baseUrl}}/chat/conversations/999
Authorization: Bearer {{token}}

###
# Error 5: Send too long message (> 5000 chars)
POST {{baseUrl}}/chat/conversations/{{conversationId}}/messages
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "message": "A very long message that exceeds 5000 characters..."
}

###
# ðŸ”§ Helper: Login to get token
POST {{baseUrl}}/accounts/login
Content-Type: application/json

{
  "email": "student1@dtu.edu.vn",
  "password": "password123"
}

###
# ðŸ”§ Helper: Get all matches (to get match_id)
GET {{baseUrl}}/matches
Authorization: Bearer {{token}}

###

