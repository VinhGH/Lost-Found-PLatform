---
alwaysApply: true
---
{
  "project_name": "Lost & Found Platform",
  "rules": [
    {
      "scope": "global",
      "instructions": [
        "Dự án sử dụng kiến trúc tách biệt: backend (Express + SQL Server) và frontend (React + Vite + Material UI).",
        "Cursor chỉ được phép chỉnh sửa trong thư mục frontend/ và backend/ — không tự tạo file ngoài phạm vi này.",
        "Không tự động tạo module lớn hoặc refactor toàn bộ project nếu không có hướng dẫn cụ thể từ developer.",
        "Chỉ tạo file mới khi thật sự cần thiết (ví dụ: component React, route Express, hoặc controller), phải đặt đúng vị trí theo cấu trúc thư mục.",
        "Không sửa hoặc ghi đè file .env.",
        "Tôn trọng coding style hiện có của nhóm: giữ nguyên indent, nháy đơn, và convention đặt tên."
      ]
    },
    {
      "scope": "frontend",
      "path": "frontend/",
      "instructions": [
        "Dự án frontend chạy bằng React + Vite + Axios + Material UI.",
        "Không sử dụng CRA (Create React App).",
        "Các component React phải đặt trong src/components hoặc src/pages.",
        "Luôn dùng function component và React hooks (useState, useEffect, useContext, ...). Không dùng class component.",
        "Toàn bộ request API phải sử dụng axios từ services/api.js. Không được hardcode URL trong component.",
        "Axios phải có baseURL: http://localhost:5000/api.",
        "Mọi form đăng nhập/đăng ký phải validate email @dtu.edu.vn trước khi gửi API.",
        "Không lưu password plaintext trong console.log hoặc localStorage.",
        "Chỉ lưu JWT token (nếu có) trong localStorage với key 'token'.",
        "Khi login/register thành công, hiển thị thông báo rõ ràng cho người dùng (alert, toast hoặc snackbar).",
        "Tuân thủ Material UI design: ưu tiên các component sẵn có (Button, TextField, Dialog, Typography, v.v.).",
        "Không thêm thư viện UI mới nếu chưa có trong package.json.",
        "Khi sửa UI, chỉ thay đổi style qua props hoặc sx={} của Material UI — không override CSS sâu.",
        "Luôn đảm bảo code FE chạy được bằng npm run dev (port 5173)."
      ]
    },
    {
      "scope": "backend",
      "path": "backend/",
      "instructions": [
        "Dự án backend chạy trên Node.js với Express framework và SQL Server.",
        "Không dùng ORM (Sequelize, Prisma, v.v.) — chỉ dùng thư viện mssql hoặc tedious để kết nối DB.",
        "Mọi truy vấn SQL phải dùng prepared statements hoặc stored procedure, tuyệt đối không nối chuỗi trực tiếp.",
        "Cấu trúc thư mục chuẩn: routes/, controllers/, config/, middlewares/, services/.",
        "Luôn import và sử dụng express.json() và cors().",
        "Port backend cố định là 5000.",
        "Các route phải bắt đầu bằng /api/, ví dụ: /api/auth/login, /api/posts, /api/match.",
        "File index.js hoặc app.js phải có app.use('/api/auth', authRoutes).",
        "Response của controller phải là JSON chuẩn hóa: { success, message, data } hoặc { token, user }.",
        "Không gửi HTML hoặc string thô từ API.",
        "Không log thông tin nhạy cảm (password, token, query SQL) ra console.",
        "Đảm bảo sử dụng biến môi trường (process.env) cho DB, JWT, và CORS.",
        "Sử dụng try/catch trong mọi hàm async để tránh crash server.",
        "Nếu kết nối DB thất bại, log lỗi nhưng không tắt server hoàn toàn.",
        "CORS phải cho phép FE: process.env.CORS_ORIGIN = http://localhost:5173.",
        "Khi thêm route mới, phải tạo controller và service tương ứng để tách logic rõ ràng."
      ]
    },
    {
      "scope": "auth",
      "path": "backend/routes/auth.js",
      "instructions": [
        "Router phải có 2 endpoint chính: POST /login và POST /register.",
        "Controller login phải kiểm tra email tồn tại trong DB và bcrypt.compare(password).",
        "Nếu đúng, trả về status 200 và JSON: { token, user }. Nếu sai, trả về status 401 và message 'Invalid credentials'.",
        "Không trả về password trong response user.",
        "Controller register phải hash mật khẩu bằng bcrypt trước khi lưu.",
        "Khi tạo tài khoản mới, validate email @dtu.edu.vn và tránh trùng lặp.",
        "Các lỗi phải được trả về dạng JSON: { success: false, message: '...' }.",
        "Không dùng console.log để debug password hoặc JWT token."
      ]
    },
    {
      "scope": "frontend-auth",
      "path": "frontend/src/components/AuthForm.jsx",
      "instructions": [
        "Hàm handleSubmit phải gửi request API bằng axios tới /auth/login hoặc /auth/register.",
        "Khi nhận response, nếu có token, lưu vào localStorage với key 'token' và chuyển hướng người dùng (hoặc hiển thị alert).",
        "Hiển thị lỗi rõ ràng nếu API trả 400 hoặc 401.",
        "Không log formData hoặc mật khẩu ra console.",
        "Các input phải có type phù hợp: email, password.",
        "Sử dụng Material UI TextField, Button, và FormControl để đảm bảo tính nhất quán UI."
      ]
    },
    {
      "scope": "security",
      "instructions": [
        "Không log dữ liệu nhạy cảm như mật khẩu, token, hoặc query SQL.",
        "Không commit file .env lên repository.",
        "Không in lỗi chi tiết SQL ra response client.",
        "Không để token hoặc key hardcode trong code.",
        "Bật CORS với origin được định nghĩa trong .env.",
        "Dùng bcrypt để hash password và JWT để tạo token.",
        "JWT secret phải được lấy từ biến môi trường."
      ]
    },
    {
      "scope": "linting",
      "instructions": [
        "Dấu nháy đơn ('') thay vì nháy kép (\"\").",
        "Indent 2 spaces trong toàn bộ JS/JSX.",
        "Luôn có dấu ; kết thúc mỗi statement.",
        "Tên biến theo camelCase, tên component theo PascalCase.",
        "Không để console.log() trong production code.",
        "Viết comment rõ ràng khi function hoặc query có logic phức tạp.",
        "Ưu tiên async/await thay cho promise .then() chain."
      ]
    },
    {
      "scope": "error-handling",
      "instructions": [
        "Toàn bộ API backend phải có khối try/catch bao quanh logic chính.",
        "Khi xảy ra lỗi, trả JSON: { success: false, message: error.message }.",
        "Không để server crash khi gặp lỗi DB hoặc lỗi truy vấn.",
        "Log lỗi ra console server, không gửi stack trace ra client."
      ]
    }
  ]
}
